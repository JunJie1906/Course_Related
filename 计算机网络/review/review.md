[TOC]

# 概述

## 网络的几个性能标准

### 速率

b/s

kb/s

### 带宽

b/s

**最高数据率**

### 吞吐量

单位时间内通过某个网络（信道，接口）的数据量

受带宽和网络额定速率限制

### 时延

#### 发送时延

**发送**开始到**发送**结束的时间

#### 传播时延

信道长度 / $2*10^8m/s$ 

#### 处理时延

交换结点为存储转发而进行一些必要的处理所花费的时间

#### 排队时延

结点缓存队列中分组排队所经历的时延。

取决于网络当时的通信量

#### 总时延

发送时延+传播时延+处理时延+排队时延

### 时延带宽积

**传播**时延×带宽

链路的时延带宽积又称为**以比特为单位的链路长度**。 

### 利用率

#### 信道利用率

指出**某信道**有百分之几的时间是被利用的（有数据通过）。

完全空闲的信道的利用率是零。

#### 网络利用率

全网络的**信道利用率**的加权平均值。

### 时延与网络利用率的关系

若令 $D_0$ 表示网络空闲时的时延，$D$ 表示网络当前的时延

![image-20200104124438082](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104124438082.png)

$U$是网络利用率,0-1之间

#### 解释

网络利用率越高，**当前网络**的时延越长

![image-20200104124647684](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104124647684.png)

## 分层

### OSI七层协议

应用层

表示层

会话层

运输层

网络层

数据链路层

物理层

### 五层协议体系结构

应用层

运输层

网络层

数据链路层

物理层

#### 传输过程

应用数据加上**应用层头**，传给运输层，加上**运输层头**，**变成UDP/TCP数据报**传给网络层，加上**网络层头**，变成**IP数据报（或者分组）**，传给链路层，加上**链路层首尾部**，变成**链路层帧**，传给物理层

![image-20200104125416693](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104125416693.png)

# 物理层

## 通信概念

### 单向通信

只能一个方向发送消息，一个只能发，一个只能收，是**单行道**

### 半双工通信

既可以发，也可以收，但是不能同时发消息，是**只能容得下一辆车走的小路**

### 全双工通信

可以同时收发消息，是**双向车道**

## 信道复用技术

### 频分复用FDM (Frequency Division Multiplexing)

![image-20200104130146317](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104130146317.png)

### 时分复用TDM (Time Division Multiplexing)

每个用户在一个周期内交替使用信道

![image-20200104130206905](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104130206905.png)

### 统计时分复用STDM（Statistic TDM）

加强了时分复用的利用率

![image-20200104130353237](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104130353237.png)

### 波分复用WDM(Wavelength Division Multiplexing)

就是**光的频分复用**

每个用户占用一个光波频率

### 码分复用

每个基站都有一个唯一的正交芯片，如 p= (-1,-1,1,1,-1,1,1,1)

每次发送0时，就发送p‘，即p的反码，发送1时，就发送p

# 数据链路层

## 三个基本问题

### 封装成帧

在数据前后添加**首部和尾部**，就构成了一个**帧**

#### 首部尾部

作用是：**帧定界**

![image-20200104150817466](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104150817466.png)

### 透明传输

![image-20200104150854067](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104150854067.png)

#### 解决方法：

##### 字节填充

在出现SOH，EOT时候在前面加一个ESC字符

##### 字符填充

每出现5个1，加上一个0

### 差错控制

#### CRC校验

例如 1101

**二进制除法**，得到**三位**的余数作为**帧检验序列 FCS (Frame Check Sequence)**

## PPP协议（Point-to-Point Protocol）

**点对点的**

### PPP协议帧格式

![image-20200104152055345](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104152055345.png)

7E FF 03 _ _  ***IP数据报***  FCS 7E

**标志字段** F = 7E (01111110)

**地址字段** A = FF（**事实上不起作用**）

**控制字段** C = 03

**协议字段**：

当协议字段为 **0x0021** 时，PPP 帧的信息字段就是**IP 数据报**。
若为 **0xC021**, 则信息字段是 **PPP 链路控制数据**。
若为 **0x8021**，则表示这是**网络控制数据**。  



> 将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列(0x7D, 0x5E)。 
> 若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列(0x7D, 0x5D)。
> 若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变。  

## 局域网

### 常见的拓扑结构

1. 星型

2. 环形

3. 总线型

4. 网状结构

5. 树形

### 10BASE-T

使用集线器

**物理上的星型，逻辑上总线型**，使用CSMA/CD协议

## CSMA/CD协议

### 解释

1. 载波监听（Carrier Sense）：开始发数据前检测线路是否空闲，发数据时继续监听，实质是**收数据**,就是用电子技术检测总线上有没有其他计算机发送的数据信号

2. 多点接入（Multiple Assess）：

   总线型网络，多个用户接入

   **PPP：只有两个点接入**

3. 碰撞检测（Collision Detection）：

   一旦听到**电压变化**就说明发生碰撞，**边发送数据边检测**信道上的信号电压大小

   > 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）。
   > 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
   > 所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“冲突检测”。



### 传数据过程

检测线路是否空闲，如果空闲就发送，然后**持续监听**

一旦检测到发生了碰撞，立即停止发送

当过了**争用期**（2$\tau$）时间后，就说明这次传送已经**不会产生碰撞**了

在开始发送数据后，**每次检测到碰撞就停止一段时间**，遵循下面规则

![image-20200104155351750](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104155351750.png)

**重传16次**还没成功就抛弃

#### 争用期长度

以太网取  $51.2\mu s$ 为争用期的长度。
对于 $10 Mb/s$ 以太网，在争用期内可发送$512 bit$，即 64 字节。
以太网在发送数据时，**若前 64 字节没有发生冲突，则后续的数据就不会发生冲突。** 

以太网规定了**最短有效帧长为 64 字节**，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧。 



## MAC地址

**网卡**的全球唯一的编号

48位，6字节



### 以太网的MAC帧格式

![image-20200104160356017](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104160356017.png)

**由上面CSMA/CD的最短帧得到，帧最短长度为64B，去掉首尾18字节，数据部分最短46Byte**

所以有效MAC帧长度为**64 ~ 1518 B**

对于检查出的**无效 MAC 帧就简单地丢弃**。以太网**不负责重传**丢弃的帧。 



### 帧间最小间隔

帧间最小间隔为  $9.6\mu s$ ，**相当于 96 bit 的发送时间**。
一个站在检测到总线开始空闲后，还要等待 $9.6\mu s$ 才能再次发送数据。
这样做是为了**使刚刚收到数据帧的站的接收缓存来得及清理**，做好接收下一帧的准备。

## 扩展的局域网

### 物理层上的扩展

#### 转发器/中继器/集线器

物理上的把线连起来，对信号不做任何处理

#### 优点

使原来属于不同碰撞域的局域网上的计算机能够进行**跨碰撞域的通信**。
扩大了局域网覆盖的地理范围。

#### 缺点

碰撞域增大了，但总的**吞吐量并未提高**。
如果**不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来**。   



### 链路层的扩展

#### 网桥

##### 功能

它根据 **MAC 帧的目的地址**对收到的帧进行转发

具有**过滤帧**的功能，当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先**检查此帧的目的 MAC 地址**，然后再**确定将该帧转发到哪一个接口** 

![image-20200104161923314](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104161923314.png)

**网桥使各网段成为隔离开的碰撞域** 

![image-20200104162025620](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104162025620.png)

##### 缺点

1. 存储转发**增加了时延**。 
2. 在MAC 子层并**没有流量控制功能**。 
3. 具有不同 MAC 子层的网段桥接在一起时时延更大。
4. 网桥**只适合于用户数不太多**(不超过几百个)和**通信量不太大**的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的**广播风暴**。  

##### 网桥和集线器的不同

**网桥**在转发帧之前必须**执行 CSMA/CD 算法**，若在发送过程中出现碰撞，就必须停止发送和进行退避。

集线器不做任何处理

##### 转发表建立过程

![image-20200104162615770](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104162615770.png)

![image-20200104163717574](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104163717574.png)

##### 转发表的信息

**地址**

**接口**

**该帧进入网桥的时间**



#### 以太网交换机

即**多接口的网桥**

各个层的转发器有一个连通就行，如网桥，路由器等选择一个



# 网络层

## 网络的划分

### ABCDE类网络

![image-20200104164223242](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104164223242.png)

ABC类网络号分别为 1,2,3个字节，主机号分别为3,2,1个字节

#### ABC类网络IP范围

![image-20200104164434047](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104164434047.png)

### 特殊的IP地址

#### 广播地址

主机地址全为 1 

#### 组播地址

就是**D类地址**

224.0.0.0/8到239.255.255.255/8

1110 0000.0.0.0

1110 1111.255.255.255

 **224.0.0.1特指所有主机**

 **224.0.0.2特指所有路由器**

#### 私有地址

10.x.x.x（A类）

172.16.x.x-172.31.x.x（B类）

192.168.x.x（C类）

#### 环回地址

 127.0.0.1 

即 localhost



 **对一台网络上的主机来说，它可以正常接收的合法目的网络地址有三种：**

1. 本机的IP地址
2. 广播地址
3. 组播地址



## 路由器

### 分组转发流程

#### 产生原因

若按**目的主机号**来制作路由表，则所得出的路由表就会**过于庞大**。

但若按**主机所在的网络地址**来制作路由表，那么每一个路由器中的路由表就只包含少量项目，这样就可使路由表大大简化。

#### 特定主机路由

为特定的主机指明一个路由

采用特定主机路由可使网络管理人员能**更方便地控制网络和测试网络**，同时也可在**需要考虑某种安全问题时**采用这种特定主机路由。 

#### 默认路由

如果**路由表**里**没有**就交给**默认路由**转发，让默认路由器再转发给下一个路由器

![image-20200104174250193](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104174250193.png)

#### 分组转发流程

(1)  从**数据报**的首部**提取目的主机的 IP 地址 D**, 得出**目的网络地址为 N**。
(2)  若**网络 N** 与**此路由器直接相连**，则把数据报**直接交付目的主机 D**；（**到了目的网络**）

**否则**是间接交付，**执行(3)**。
(3)  若**路由表中有**目的地址为 **D的特定主机路由**，则把数据报**送到主机D的的下一跳**

**否则**，**执行(4)。**
(4)  若**路由表中**有到达**网络 N 的路由**，则把数据报**送到网络N的下一跳**

**否则，执行(5)。**
(5) 若路由表中有一个**默认路由**，则把数据报**送到默认路由**

**否则，执行(6)。**
(6)  报告转发分组**出错**。 



总结下来就是，先得到**主机IP地址**，得到**对应的网络号**，看是不是**此网络**的主机，再看是不是**特定主机路由**，再检查有没有**到此网络的记录**，再经过**默认路由**，否则出错



## ARP协议

把IP地址转化为MAC地址

### ARP高速缓存

**每一个主机**都设有一个 ARP 高速缓存

有**所在的局域网**上的各**主机和路由器**的 **IP 地址**到**硬件地址**的映射表。

### RARP

反向ARP

## IPv4数据报

### IPv4数据报格式

![image-20200104171458169](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104171458169.png)

#### 版本

占 **4 位**，指 **IP 协议的版本**，目前的 IP 协议版本号为 4 (即 IPv4)

#### 首部长度

占**4位**，最大15，单位为**4字节**，最大长度为60B

#### 区分服务

占 **8 位**，用来获得更好的服务

不过**一般没用**

#### 总长度

占**16位**，**首部和数据之和**的长度，单位**字节**

**总长度必须不超过最大传送单元 MTU**

#### 标识

**16位**，它是一个**计数器**，用来**产生数据报的标识**。

#### 标志

占 **3 位**，目前只有前两位有意义。

**MF DF Unused**

##### MF (More Fragment)

MF = 1 表示后面“还有分片”。MF = 0 表示最后一个分片。

##### DF (Don't Fragment) 

只有当 DF = 0 时才允许分片。 

#### 片偏移

**13位**，在原分组的相对位置，**单位为8字节**

分片例子：

![image-20200104172420454](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104172420454.png)

#### 生存时间

**8位**，**可通过的路由器数**的最大值

#### 协议

**8位**

上层的协议类型，用来确定把数据交给谁，如TCP, UDP, ICMP, IGMP, OSPF等

![image-20200104172919227](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104172919227.png)

#### 首部检验和

**16位**

**只检验数据报首部**

![image-20200104173019156](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104173019156.png)

就是把首部**每16位做二进制加法**，结果**取反**放入首部检验和字段

验证时候只需要将**每个16位按二进制加法加起来**，然后**取反**，如果**等于0**就说明正确，否则出错，丢弃该数据报

#### 源地址/目的地址

每个**32位**，即**4字节的IP地址**

#### 可变部分

很少使用，暂时不记录



## IPv6

长度 16字节

### 写法

用16进制数写，每16位（2字节）加一个冒号

#### 0压缩

如果中间有很多0的话，可以用一个0代替，**只能用一次**



## 子网划分

![image-20200104175742060](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104175742060.png)



### 子网掩码

不说了

## ICMP

允许主机或路由器**报告差错情况**和**提供有关异常情况**的报告。

### ICMP 差错报告报文

#### 5种差错报告

终点不可达 
源点抑制(Source quench)  
时间超过 
参数问题 
改变路由（重定向）(Redirect) 

#### ICMP差错报告数据报内容

![image-20200104194005685](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104194005685.png)

### ICMP 询问报文

#### 2种询问报文

回送请求和回答报文
时间戳请求和回答报文

### 应用举例

#### ping

回送请求和回答报文

#### traceroute

##### 工作流程

先发送TTL=1的数据报，遇到第一个路由器，发送一个错误报告，知道了那个路由器

然后发送TTL=2的数据报，等等



## 路由选择协议

### 内部网关协议

#### RIP

##### 基于距离向量算法

1. 仅和**相邻路由器**交换信息。 
2. **交换的信息**是当前本路由器所知道的**全部信息**，即自己的路由表。 
3. 按**固定的时间间隔**交换路由信息，例如，每隔 30 秒。 

4. **超过16**跳就判定为不可达

##### 特点

好消息传的快，坏消息传的慢

#### OSPF

（Open Shortest Path First）

##### 基于dijkstra最短路的算法

1. 向**本自治系统中所有路由器**发送信息，这里使用的方法是**洪泛法**。
2. 发送的信息就是**与本路由器相邻的**所有路由器的**链路状态**，但这只是路由器所知道的部分信息。
3. “链路状态”就是说明本路由器都和哪些路由器相邻，以及该链路的“度量”(metric)。 
4. 只有当**链路状态发生变化时**，路由器才用**洪泛法**向**所有路由器**发送此信息。  

##### 传播方式

直接使用**IP数据报**传播

# 运输层

**端到端的通信**

### 知名端口号

DNS端口号 ： 53

HTTP协议代理服务器常用端口号：80/8080/3128/8081/9080

FTP（文件传输）协议代理服务器常用端口号：21

### TCP

#### 报文段格式

![image-20200104212409827](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104212409827.png)

#### 可靠传输的实现

##### 滑动窗口

**确认**

按照**字节流**来发送，给每个字节编号，编号范围为2^32，接受成功后发送一个确认报文段，确认报文段为最前面需要的字节编号

![image-20200104213448361](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104213448361.png)

**重传**

重传时间：加权平均往返时间

#### 流量控制

目的：让发送的人慢点，要让接收方来得及接收

发送方的滑动窗口大小取决于接收方

**一个例子**

![image-20200104214733458](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104214733458.png)



#### 拥塞控制

##### 拥塞

在网络中，带宽，缓存，CUP等都叫**资源**

对网络中对**某一资源的需求大于可用资源**，网络性能变坏，叫拥塞

##### 慢开始和拥塞避免

![image-20200104220408100](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104220408100.png)

假定拥塞窗口的数值增长到 24 时，网络出现超时，表明网络拥塞了。 

更新后的 ssthresh 值变为 12（即发送窗口数值 24 的一半），拥塞窗口再重新设置为 1，并执行慢开始算法。 



##### 快重传和快恢复

快重传：收到三个连续的对某一字节的确认就立即重传接下来的那字节

![image-20200104221258469](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104221258469.png)

#### 连接建立

**三次握手**

![image-20200104222000714](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104222000714.png)

**四次挥手**

![image-20200104222016378](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104222016378.png)



# 应用层

## DNS

### 域名分类

#### 根域名

所有顶级域名的父节点

#### 顶级域名

##### 国家级

.cn

.us

.uk

##### 通用顶级域名

.com

.org

.edu

.gov

.int

.info

......

##### 反向域名

只有一个 arpa

##### 二级域名，三级域名......

![image-20200104222537525](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104222537525.png)

### 域名服务器

根域名服务器 
顶级域名服务器 
权限域名服务器 
本地域名服务器

#### 查询方式

##### 递归查询

![image-20200104223332027](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104223332027.png)

##### 迭代查询

![image-20200104223249561](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200104223249561.png)

**主机**向**本地域名服务器**的查询一般都是采用**递归查询**

**本地域名服务器**向**根域名服务器**的查询通常是采用**迭代查询**

## FTP

FTP 的主要功能是减少或消除在不同操作系统下处理文件的不兼容性。

**一个 FTP 服务器进程**可同时为**多个客户**进程提供服务，FTP 的服务器进程由**两大部分**组成：一个**主进程**，负责**接受新的请求**；另外有**若干个从属进程**，负责**处理单个请求**。

### 工作流程

**打开**熟知端口（**端口号为 21**），使客户进程能够连接上。
**等待**客户进程发出**连接请求**。
**启动从属进程**来处理客户进程发来的请求。**从属进程**对客户进程的请求**处理完毕后即终止**，但**从属进程**在运行期间根据需要**还可能创建其他一些子进程**。
**回到等待状态**，继续接受其他客户进程发来的请求。**主进程与从属进程的处理是并发地进行。** 

### 两个连接

**控制连接**在整个会话期间**一直保持打开**，FTP 客户发出的传送请求通过控制连接发送给服务器端的控制进程，但控制连接**不用来传送文件**。
实际用于传输文件的是“**数据连接**”。服务器端的**控制进程**在**接收**到 FTP **客户**发送来的**文件传输请求**后就**创建**“数据传送进程”和“数据连接”，用来**连接**客户端和服务器端的**数据传送进程**。
**数据传送进程实际完成文件的传送**，在**传送完毕后关闭**“数据传送**连接**”并结束运行。 

#### 两个端口号

 当客户进程向服务器进程**发出建立连接请求**时，要**寻找**连接服务器进程的熟知端口(**21**)，同时还要**告诉服务器进程自己的另一个端口号码**，用于建立数据传送连接。
接着，**服务器进程**用自己**传送数据的熟知端口(20)**与**客户进程所提供的端口号码**建立**数据传送连接**。
由于 FTP 使用了两个不同的端口号，所以**数据连接**与**控制连接**不会发生混乱。

#### 使用两个端口号的好处

使协议更加简单和更容易实现。
在传输文件时还可以利用控制连接（例如，客户发送请求终止传输）。 

## WWW（World Wide Web）

万维网是**分布式超媒体(hypermedia)系统**，它是超文本(hypertext)系统的扩充。

### URL

**统一资源定位符（Uniform Resource Locator）**是对**可以从因特网上得到的资源**的**位置和访问方法**的一种简洁的表示。

#### 一般形式

<协议>://<主机>:<端口>/<路径> 

### http

**（HyperText Transfer Protocol）超文本传输协议**

利用TCP建立连接



# 无线网

也分为广域网，城域网，局域网，个人局域网

平常用的手机就是**无线广域网**

**无线城域网**：WiMAX

**无线广域网**：蜂窝无线通信网

**无线个人区域网**：蓝牙，ZigBee，超高速WPAN

